# Library Management System

REST API –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –±–∏–±–ª–∏–æ—Ç–µ–∫–æ–π –Ω–∞ FastAPI —Å JWT –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–µ–π.

## –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è

- Python 3.9+
- PostgreSQL
- pip

## –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∏ –∑–∞–ø—É—Å–∫

### 1. –ö–ª–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ —É—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π
```bash
git clone <repository>
cd library-test
pip install -r requirements.txt
```

### 2. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ë–î
```bash
# –°–æ–∑–¥–∞–π—Ç–µ .env —Ñ–∞–π–ª –Ω–∞ –æ—Å–Ω–æ–≤–µ .env.example
cp .env.example .env

# –û—Ç—Ä–µ–¥–∞–∫—Ç–∏—Ä—É–π—Ç–µ .env —Å –≤–∞—à–∏–º–∏ –¥–∞–Ω–Ω—ã–º–∏ PostgreSQL
DB_HOST=localhost
DB_PORT=5432
DATABASE=library_db
DB_USER=postgres
DB_PASSWORD=your_password
SECRET_KEY=your_secret_key_here
```

### 3. –ú–∏–≥—Ä–∞—Ü–∏–∏
```bash
alembic upgrade head
```

### 4. –ó–∞–ø—É—Å–∫
```bash
uvicorn main:app --reload
```

API –¥–æ—Å—Ç—É–ø–µ–Ω –ø–æ –∞–¥—Ä–µ—Å—É: `http://localhost:8000`
–î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è: `http://localhost:8000/docs`

### 5. –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –ø–µ—Ä–≤–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
```bash
curl -X POST "http://localhost:8000/auth/register" \
  -H "Content-Type: application/json" \
  -d '{"email": "admin@library.com", "password": "password123"}'
```

## –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞

```
app/
‚îú‚îÄ‚îÄ database/          # –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ –ë–î
‚îú‚îÄ‚îÄ models/           # SQLAlchemy –º–æ–¥–µ–ª–∏
‚îú‚îÄ‚îÄ schemas/          # Pydantic —Å—Ö–µ–º—ã
‚îú‚îÄ‚îÄ routes/           # API —Ä–æ—É—Ç—ã
‚îú‚îÄ‚îÄ services/         # –ë–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞
‚îú‚îÄ‚îÄ utils/            # –í—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏
‚îî‚îÄ‚îÄ settings.py       # –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

alembic/              # –ú–∏–≥—Ä–∞—Ü–∏–∏ –ë–î
tests/                # –¢–µ—Å—Ç—ã
```

## –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –ë–î

### –ü—Ä–∏–Ω—è—Ç—ã–µ —Ä–µ—à–µ–Ω–∏—è:

**1. –¢–∞–±–ª–∏—Ü—ã:**
- `users` - –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ —Å–∏—Å—Ç–µ–º—ã (JWT –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è)
- `books` - –∫–∞—Ç–∞–ª–æ–≥ –∫–Ω–∏–≥
- `readers` - —á–∏—Ç–∞—Ç–µ–ª–∏ –±–∏–±–ª–∏–æ—Ç–µ–∫–∏
- `borrowed_books` - –∂—É—Ä–Ω–∞–ª –≤—ã–¥–∞—á/–≤–æ–∑–≤—Ä–∞—Ç–æ–≤

**2. –ö–ª—é—á–µ–≤—ã–µ —Ä–µ—à–µ–Ω–∏—è:**
- **–†–∞–∑–¥–µ–ª–µ–Ω–∏–µ users –∏ readers** - –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ —Å–∏—Å—Ç–µ–º—ã –æ—Ç–¥–µ–ª—å–Ω–æ –æ—Ç —á–∏—Ç–∞—Ç–µ–ª–µ–π –±–∏–±–ª–∏–æ—Ç–µ–∫–∏
- **–ú—è–≥–∫–æ–µ —É–¥–∞–ª–µ–Ω–∏–µ –≤ borrowed_books** - return_date NULL = –∞–∫—Ç–∏–≤–Ω–∞—è –≤—ã–¥–∞—á–∞
- **Constraint –Ω–∞ copies** - –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —ç–∫–∑–µ–º–ø–ª—è—Ä–æ–≤ >= 0
- **–£–Ω–∏–∫–∞–ª—å–Ω—ã–µ –∏–Ω–¥–µ–∫—Å—ã** - email —á–∏—Ç–∞—Ç–µ–ª–µ–π, ISBN –∫–Ω–∏–≥

### –°—Ö–µ–º–∞ —Å–≤—è–∑–µ–π:
```
books ‚îÄ‚îÄ‚îê
        ‚îú‚îÄ‚îÄ borrowed_books ‚îÄ‚îÄ‚îÄ‚îÄ readers
users ‚îÄ‚îÄ‚îò
```

## –†–µ–∞–ª–∏–∑–∞—Ü–∏—è –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∏

### –°–ª–æ–∂–Ω–æ—Å—Ç–∏ –∏ —Ä–µ—à–µ–Ω–∏—è:

**4.1 –ö–æ–Ω—Ç—Ä–æ–ª—å –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ —ç–∫–∑–µ–º–ø–ª—è—Ä–æ–≤:**
- **–ü—Ä–æ–±–ª–µ–º–∞:** –ö–æ–Ω–∫—É—Ä–µ–Ω—Ç–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã –º–æ–≥—É—Ç –ø—Ä–∏–≤–µ—Å—Ç–∏ –∫ –æ—Ç—Ä–∏—Ü–∞—Ç–µ–ª—å–Ω–æ–º—É –∫–æ–ª–∏—á–µ—Å—Ç–≤—É
- **–†–µ—à–µ–Ω–∏–µ:** –ü—Ä–æ–≤–µ—Ä–∫–∞ `copies >= 1` –ø–µ—Ä–µ–¥ –≤—ã–¥–∞—á–µ–π + —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏
- **–†–µ–∞–ª–∏–∑–∞—Ü–∏—è:** `check_book_availability()` –≤ `services/circulation.py`

**4.2 –õ–∏–º–∏—Ç 3 –∫–Ω–∏–≥–∏ –Ω–∞ —á–∏—Ç–∞—Ç–µ–ª—è:**
- **–ü—Ä–æ–±–ª–µ–º–∞:** –ü–æ–¥—Å—á–µ—Ç –∞–∫—Ç–∏–≤–Ω—ã—Ö –≤—ã–¥–∞—á
- **–†–µ—à–µ–Ω–∏–µ:** –ó–∞–ø—Ä–æ—Å `WHERE return_date IS NULL` + –ø—Ä–æ–≤–µ—Ä–∫–∞ –ª–∏–º–∏—Ç–∞
- **–†–µ–∞–ª–∏–∑–∞—Ü–∏—è:** `check_borrow_limit()` –ø–æ–¥—Å—á–∏—Ç—ã–≤–∞–µ—Ç –Ω–µ–≤–æ–∑–≤—Ä–∞—â–µ–Ω–Ω—ã–µ –∫–Ω–∏–≥–∏

**4.3 –ö–æ–Ω—Ç—Ä–æ–ª—å –≤–æ–∑–≤—Ä–∞—Ç–∞:**
- **–ü—Ä–æ–±–ª–µ–º–∞:** –ü—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–µ–Ω–∏–µ –ø–æ–≤—Ç–æ—Ä–Ω–æ–≥–æ –≤–æ–∑–≤—Ä–∞—Ç–∞
- **–†–µ—à–µ–Ω–∏–µ:** –ü–æ–∏—Å–∫ –∑–∞–ø–∏—Å–∏ —Å `return_date IS NULL`
- **–†–µ–∞–ª–∏–∑–∞—Ü–∏—è:** `check_borrow_record()` –ø—Ä–æ–≤–µ—Ä—è–µ—Ç —Å—É—â–µ—Å—Ç–≤–æ–≤–∞–Ω–∏–µ –∞–∫—Ç–∏–≤–Ω–æ–π –≤—ã–¥–∞—á–∏

### –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω—ã–µ —Ä–µ—à–µ–Ω–∏—è:
- **–°–ª–æ–π services** - –≤—ã–Ω–æ—Å –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∏ –∏–∑ —Ä–æ—É—Ç–æ–≤
- **–ê—Ç–æ–º–∞—Ä–Ω—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏** - –≤—Å–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è –≤ –æ–¥–Ω–æ–π —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏
- **–í–∞–ª–∏–¥–∞—Ü–∏—è –Ω–∞ —Ä–∞–∑–Ω—ã—Ö —É—Ä–æ–≤–Ω—è—Ö** - Pydantic + –±–∏–∑–Ω–µ—Å-–ø—Ä–∞–≤–∏–ª–∞

## –°–∏—Å—Ç–µ–º–∞ –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏

### –¢–µ—Ö–Ω–æ–ª–æ–≥–∏–∏:
- **JWT —Ç–æ–∫–µ–Ω—ã** (–±–∏–±–ª–∏–æ—Ç–µ–∫–∞ `python-jose`)
- **Bcrypt** –¥–ª—è —Ö–µ—à–∏—Ä–æ–≤–∞–Ω–∏—è –ø–∞—Ä–æ–ª–µ–π
- **OAuth2PasswordBearer** –¥–ª—è –∏–∑–≤–ª–µ—á–µ–Ω–∏—è —Ç–æ–∫–µ–Ω–æ–≤

### –ü—Ä–∏–Ω—Ü–∏–ø—ã:
```python
# –ì–µ–Ω–µ—Ä–∞—Ü–∏—è —Ç–æ–∫–µ–Ω–∞
access_token = jwt.encode(
    {"sub": user_id, "exp": expire_time}, 
    SECRET_KEY, 
    algorithm="HS256"
)

# –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ç–æ–∫–µ–Ω–∞
payload = jwt.decode(token, SECRET_KEY, algorithms=["HS256"])
```

### –ó–∞—â–∏—â–µ–Ω–Ω—ã–µ —ç–Ω–¥–ø–æ–∏–Ω—Ç—ã:
- **–í—Å–µ CRUD –æ–ø–µ—Ä–∞—Ü–∏–∏** - —Ç—Ä–µ–±—É—é—Ç –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏
- **–ü—É–±–ª–∏—á–Ω—ã–π –¥–æ—Å—Ç—É–ø** - —Ç–æ–ª—å–∫–æ GET `/books/` (–ø—Ä–æ—Å–º–æ—Ç—Ä –∫–∞—Ç–∞–ª–æ–≥–∞)
- **Middleware** - `get_current_user()` dependency

### –ü–æ—á–µ–º—É JWT:
- Stateless - –Ω–µ —Ç—Ä–µ–±—É–µ—Ç —Ö—Ä–∞–Ω–µ–Ω–∏—è —Å–µ—Å—Å–∏–π
- –ú–∞—Å—à—Ç–∞–±–∏—Ä—É–µ–º–æ—Å—Ç—å - –ø–æ–¥—Ö–æ–¥–∏—Ç –¥–ª—è –º–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å–æ–≤
- –ü—Ä–æ—Å—Ç–æ—Ç–∞ - —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–π –ø–æ–¥—Ö–æ–¥ –¥–ª—è REST API

## API Endpoints

### –ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è
- `POST /auth/register` - —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è
- `POST /auth/login` - –ø–æ–ª—É—á–µ–Ω–∏–µ —Ç–æ–∫–µ–Ω–∞

### –ö–Ω–∏–≥–∏
- `GET /books/` - —Å–ø–∏—Å–æ–∫ –∫–Ω–∏–≥ (–ø—É–±–ª–∏—á–Ω—ã–π)
- `POST /books/` - –¥–æ–±–∞–≤–∏—Ç—å –∫–Ω–∏–≥—É üîí
- `GET /books/{id}` - –ø–æ–ª—É—á–∏—Ç—å –∫–Ω–∏–≥—É üîí
- `PUT /books/{id}` - –æ–±–Ω–æ–≤–∏—Ç—å –∫–Ω–∏–≥—É üîí
- `DELETE /books/{id}` - —É–¥–∞–ª–∏—Ç—å –∫–Ω–∏–≥—É üîí

### –ß–∏—Ç–∞—Ç–µ–ª–∏
- `GET /readers/` - —Å–ø–∏—Å–æ–∫ —á–∏—Ç–∞—Ç–µ–ª–µ–π üîí
- `POST /readers/` - –¥–æ–±–∞–≤–∏—Ç—å —á–∏—Ç–∞—Ç–µ–ª—è üîí
- `GET /readers/{id}` - –ø–æ–ª—É—á–∏—Ç—å —á–∏—Ç–∞—Ç–µ–ª—è üîí
- `PUT /readers/{id}` - –æ–±–Ω–æ–≤–∏—Ç—å —á–∏—Ç–∞—Ç–µ–ª—è üîí
- `DELETE /readers/{id}` - —É–¥–∞–ª–∏—Ç—å —á–∏—Ç–∞—Ç–µ–ª—è üîí

### –í—ã–¥–∞—á–∞/–≤–æ–∑–≤—Ä–∞—Ç
- `POST /circulation/borrow` - –≤—ã–¥–∞—Ç—å –∫–Ω–∏–≥—É üîí
- `POST /circulation/return` - –≤–µ—Ä–Ω—É—Ç—å –∫–Ω–∏–≥—É üîí
- `GET /circulation/{reader_id}` - –∫–Ω–∏–≥–∏ —á–∏—Ç–∞—Ç–µ–ª—è üîí

üîí - —Ç—Ä–µ–±—É–µ—Ç –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏

## –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

```bash
# –£—Å—Ç–∞–Ω–æ–≤–∫–∞ —Ç–µ—Å—Ç–æ–≤—ã—Ö –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π
pip install -r test_requirements.txt

# –ó–∞–ø—É—Å–∫ —Ç–µ—Å—Ç–æ–≤
pytest tests/
```

## –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è —Ñ–∏—á–∞: –°–∏—Å—Ç–µ–º–∞ –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è

### –ò–¥–µ—è:
–ß–∏—Ç–∞—Ç–µ–ª–∏ –º–æ–≥—É—Ç –∑–∞–±—Ä–æ–Ω–∏—Ä–æ–≤–∞—Ç—å –∫–Ω–∏–≥—É, –µ—Å–ª–∏ –≤—Å–µ —ç–∫–∑–µ–º–ø–ª—è—Ä—ã –≤—ã–¥–∞–Ω—ã.

### –†–µ–∞–ª–∏–∑–∞—Ü–∏—è:
```python
# –ù–æ–≤–∞—è —Ç–∞–±–ª–∏—Ü–∞
class BookReservation(Base):
    book_id: int
    reader_id: int 
    reservation_date: datetime
    expires_at: datetime  # 7 –¥–Ω–µ–π –Ω–∞ –ø–æ–ª—É—á–µ–Ω–∏–µ
    status: enum  # ACTIVE, FULFILLED, EXPIRED
```

### –ë–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞:
1. **–ü—Ä–∏ –≤—ã–¥–∞—á–µ** - –ø—Ä–æ–≤–µ—Ä–∏—Ç—å –æ—á–µ—Ä–µ–¥—å –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–π
2. **–ü—Ä–∏ –≤–æ–∑–≤—Ä–∞—Ç–µ** - —É–≤–µ–¥–æ–º–∏—Ç—å —Å–ª–µ–¥—É—é—â–µ–≥–æ –≤ –æ—á–µ—Ä–µ–¥–∏
3. **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –∏—Å—Ç–µ—á–µ–Ω–∏–µ** - celery task –¥–ª—è –æ—á–∏—Å—Ç–∫–∏ –ø—Ä–æ—Å—Ä–æ—á–µ–Ω–Ω—ã—Ö
4. **–£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è** - email/SMS –ø—Ä–∏ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏ –∫–Ω–∏–≥–∏

### –ù–æ–≤—ã–µ endpoints:
- `POST /reservations/` - –∑–∞–±—Ä–æ–Ω–∏—Ä–æ–≤–∞—Ç—å –∫–Ω–∏–≥—É
- `GET /reservations/my` - –º–æ–∏ –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è
- `DELETE /reservations/{id}` - –æ—Ç–º–µ–Ω–∏—Ç—å –±—Ä–æ–Ω—å

–≠—Ç–æ –¥–æ–±–∞–≤–∏—Ç —Å–ø—Ä–∞–≤–µ–¥–ª–∏–≤—ã–π –º–µ—Ö–∞–Ω–∏–∑–º —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è –ø–æ–ø—É–ª—è—Ä–Ω—ã—Ö –∫–Ω–∏–≥ –∏ —É–ª—É—á—à–∏—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–π –æ–ø—ã—Ç.